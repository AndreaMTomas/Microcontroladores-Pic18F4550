;====================================================================
; 		EXAMEN 1 MICROCONTROLADORES
;	     UNIVERSIDAD AUTÃ“NOMA DE GUERRERO
;	  Andrea Monserrat Tomas Acosta 16267017
; Created:   24 de Febrero de 2023
; Processor: PIC18F4550
; Compiler:  MPASM (Proteus)
;====================================================================

#include p18f4550.inc                

   CBLOCK 0X20
      VALOR1	; LEER PARTE BAJA DE LOS BITS
      VALOR2	; LEER PARTE ALTA DE LOS BITS
      MAYOR	; ASIGNA EL MAYOR DE VALOR 1 Y VALOR2
   ENDC
   
   ORG 0X00
   CLRF TRISD	; PUERTOD -> SALIDA
   CLRF TRISC	; PUERTOC -> SALIDA
   MOVLW 0XFF
   MOVWF TRISB	; PUERTOB -> ENTRADA
   
   ; TODOS PINES A DIGITALES
   MOVLW	0X0F
   MOVWF	ADCON1
   CLRF LATD
   CLRF LATB
     
   START
	PARTE_BAJA
	;========== PARTE BAJA DE BITS ===========
	MOVF PORTB, W
	MOVWF 0X20	; GUARDARLO EN 0X20
	MOVLW 0X0F	; 0 0 0 0 1 1 1 1 SEGUNDA MASCARA
	ANDWF 0X20, W
	MOVWF 0X20
	MOVWF VALOR1	; GUARDAR EN VALOR1
	
	PARTE_ALTA
	MOVF PORTB, W
	MOVWF 0X22
	; ========== PARTE ALTA DE BITS ===========
	MOVLW 0XF0 ; 1 1 1 1 0 0 0 0 (240)
	ANDWF 0X22, W	; AND CON LO GUARDADO EN W Y GUARDARLO EN W
	MOVWF 0X21	; GUARDARLO EN LA DIRECCION 0X21
	RRNCF 0X21, F	; PRIMERA ROTACION
	RRNCF 0X21, F	; SEGUNDA ROTACION
	RRNCF 0X21, F	; TERCERA ROTACION
	RRNCF 0X21, F	; CUARTA ROTACION
	MOVF 0X21, W
	MOVWF VALOR2	; GUARDAR EN VALOR2
	
	COMPARAR
	CLRF PORTB	; LIMPIAR PUERTOB
	MOVF VALOR2, W	; W = VALOR2
	CPFSGT VALOR1	; W > VALOR1?
	BRA VALOR2_MAYOR ; VALOR2 ES MAYOR
	BRA VALOR1_MAYOR ; VALOR1 ES MAYOR
	 
	VALOR2_MAYOR
	CLRF PORTB
	CLRF MAYOR
	MOVF VALOR2, W ; W = VALOR2
	MOVWF MAYOR	; MAYOR = VALOR2
	GOTO IDENTIFICAR_NUMERO
	
	VALOR1_MAYOR
	CLRF MAYOR
	CLRF PORTB
	MOVF VALOR1, W ; W = VALOR1
	MOVWF MAYOR	; MAYOR = VALOR1
	GOTO IDENTIFICAR_NUMERO
	
	IDENTIFICAR_NUMERO
	BCF PORTC, 0	; LIMPIAR RC0
	MOVLW .0
	CPFSEQ MAYOR	; MAYOR == 0?
	GOTO COMPARACION1; MAYOR != 0
	; MAYOR == 0
	MOVLW 0X3F 	; VALOR QUE MUESTRA 0 EN EL DISPLAY
	MOVWF LATD	; MOSTRAR EN PUERTO D
	GOTO START 
	
	; LAS DEMAS COMPARACIONES SON SIMILARES AL BRANCH IDENTIFICAR_NUMERO
	COMPARACION1
	MOVLW .1
	CPFSEQ MAYOR
	GOTO COMPARACION2
	MOVLW 0X06	; VALOR QUE MUESTRA 1 EN EL DISPLAY
	MOVWF LATD
	GOTO START
	
	COMPARACION2
	MOVLW .2
	CPFSEQ MAYOR
	GOTO COMPARACION3
	MOVLW 0X5B	; VALOR QUE MUESTRA 2 EN EL DISPLAY
	MOVWF LATD
	GOTO START

	COMPARACION3
	MOVLW .3
	CPFSEQ MAYOR
	GOTO COMPARACION4
	MOVLW 0X4F	; VALOR QUE MUESTRA 3 EN EL DISPLAY
	MOVWF LATD
	GOTO START
	
	COMPARACION4
	MOVLW .4
	CPFSEQ MAYOR
	GOTO COMPARACION5
	MOVLW 0X66	; VALOR QUE MUESTRA 4 EN EL DISPLAY
	MOVWF LATD
	GOTO START
	
	COMPARACION5
	MOVLW .5
	CPFSEQ MAYOR
	GOTO COMPARACION6
	MOVLW 0X6D	; VALOR QUE MUESTRA 5 EN EL DISPLAY
	MOVWF LATD
	GOTO START
	
	COMPARACION6
	MOVLW .6
	CPFSEQ MAYOR
	GOTO COMPARACION7
	MOVLW 0X7D	; VALOR QUE MUESTRA 6 EN EL DISPLAY
	MOVWF LATD
	GOTO START
	
	COMPARACION7
	MOVLW .7
	CPFSEQ MAYOR
	GOTO COMPARACION8
	MOVLW 0X07	; VALOR QUE MUESTRA 7 EN EL DISPLAY
	MOVWF LATD
	GOTO START
	
	COMPARACION8
	MOVLW .8
	CPFSEQ MAYOR
	GOTO COMPARACION9
	MOVLW 0X7F	; VALOR QUE MUESTRA 8 EN EL DISPLAY
	MOVWF LATD
	GOTO START
	
	COMPARACION9
	MOVLW .9
	CPFSEQ MAYOR
	GOTO OVERFLOW
	MOVLW 0X67	; VALOR QUE MUESTRA 9 EN EL DISPLAY
	MOVWF LATD
	GOTO START
	
	OVERFLOW	; SI EL DIGITO INTRODUCIDO ES > 9
	BSF PORTC, 0	; ENCENDER LED ROJO 
	CLRF LATD	; LIMPIAR PUERTO D
	GOTO START
	
 END
